{"ast":null,"code":"\"use strict\";\n\n/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar tf = require(\"@tensorflow/tfjs\");\nvar tfjs_1 = require(\"@tensorflow/tfjs\");\nvar util_1 = require(\"util\");\nvar int64_tensors_1 = require(\"./int64_tensors\");\n// tslint:disable-next-line:no-require-imports\nvar messages = require('./proto/api_pb');\nvar NodeJSKernelBackend = /** @class */function (_super) {\n  __extends(NodeJSKernelBackend, _super);\n  function NodeJSKernelBackend(binding, packageName) {\n    var _this = _super.call(this) || this;\n    _this.binding = binding;\n    _this.isGPUPackage = packageName === '@tensorflow/tfjs-node-gpu';\n    _this.isUsingGpuDevice = _this.binding.isUsingGpuDevice();\n    _this.tensorMap = new tf.DataStorage(_this, tf.engine());\n    return _this;\n  }\n  NodeJSKernelBackend.prototype.getDTypeInteger = function (dtype) {\n    switch (dtype) {\n      case 'float32':\n        return this.binding.TF_FLOAT;\n      case 'int32':\n        return this.binding.TF_INT32;\n      case 'bool':\n        return this.binding.TF_BOOL;\n      case 'complex64':\n        return this.binding.TF_COMPLEX64;\n      case 'string':\n        return this.binding.TF_STRING;\n      default:\n        throw new Error(\"Unsupported DType: \" + dtype);\n    }\n  };\n  NodeJSKernelBackend.prototype.typeAttributeFromTensor = function (value) {\n    return this.getDTypeInteger(value.dtype);\n  };\n  // Creates a new Tensor and maps the dataId to the passed in ID.\n  NodeJSKernelBackend.prototype.createOutputTensor = function (metadata) {\n    var newId = {};\n    this.tensorMap.set(newId, {\n      shape: metadata.shape,\n      dtype: metadata.dtype,\n      id: metadata.id,\n      values: null,\n      refCount: 1\n    });\n    var dtype;\n    switch (metadata.dtype) {\n      case this.binding.TF_FLOAT:\n        dtype = 'float32';\n        break;\n      case this.binding.TF_INT32:\n        dtype = 'int32';\n        break;\n      case this.binding.TF_INT64:\n        console.warn('INT64 output tensor will be stored as BigInt64Array.');\n        // INT64 is not supported in TFJS yet, cast it to int32.\n        dtype = 'int32';\n        break;\n      case this.binding.TF_BOOL:\n        dtype = 'bool';\n        break;\n      case this.binding.TF_COMPLEX64:\n        dtype = 'complex64';\n        break;\n      case this.binding.TF_STRING:\n        dtype = 'string';\n        break;\n      case this.binding.TF_RESOURCE:\n        // NOTE(cais): We currently represent resource-type Tensors\n        // as string of ubytes.\n        dtype = 'string';\n        break;\n      case this.binding.TF_UINT8:\n        // TensorFlow uses UINT8 as dtype for image tensor. UINT8 is not\n        // supported in TFJS yet, cast it to int32.\n        dtype = 'int32';\n        break;\n      default:\n        throw new Error(\"Unknown dtype enum \" + metadata.dtype);\n    }\n    // TODO(yassogba) Enable this once all the kernels are removed from backend.\n    // We can then change the return type from Tensor to TensorInfo.\n    // return {dataId: newId, shape: metadata.shape, dtype};\n    var tensorInfo = {\n      dataId: newId,\n      shape: metadata.shape,\n      dtype: dtype\n    };\n    return tf.engine().makeTensorFromTensorInfo(tensorInfo);\n  };\n  // Prepares Tensor instances for Op execution.\n  NodeJSKernelBackend.prototype.getInputTensorIds = function (tensors) {\n    var ids = [];\n    for (var i = 0; i < tensors.length; i++) {\n      if (tensors[i] instanceof int64_tensors_1.Int64Scalar) {\n        // Then `tensors[i]` is a Int64Scalar, which we currently represent\n        // using an `Int32Array`.\n        var value = tensors[i].valueArray;\n        var id = this.binding.createTensor([], this.binding.TF_INT64, value);\n        ids.push(id);\n      } else {\n        var info = this.tensorMap.get(tensors[i].dataId);\n        // TODO - what about ID in this case? Handle in write()??\n        if (info.values != null) {\n          // Values were delayed to write into the TensorHandle. Do that before\n          // Op execution and clear stored values.\n          info.id = this.binding.createTensor(info.shape, info.dtype, info.values);\n          info.values = null;\n        }\n        ids.push(info.id);\n      }\n    }\n    return ids;\n  };\n  NodeJSKernelBackend.prototype.createReductionOpAttrs = function (tensor, keepDims) {\n    if (keepDims === void 0) {\n      keepDims = false;\n    }\n    return [{\n      name: 'keep_dims',\n      type: this.binding.TF_ATTR_BOOL,\n      value: keepDims\n    }, createTensorsTypeOpAttr('T', tensor.dtype), createTensorsTypeOpAttr('Tidx', 'int32')];\n  };\n  NodeJSKernelBackend.prototype.floatPrecision = function () {\n    return 32;\n  };\n  NodeJSKernelBackend.prototype.epsilon = function () {\n    return _super.prototype.epsilon.call(this);\n  };\n  /**\n   * Executes an op that has a single input and output.\n   *\n   * Helper function to wrap executeSingleOutput in a particular case.\n   * @param name The name of the Op to execute.\n   * @param input The input Tensor for the Op.\n   */\n  NodeJSKernelBackend.prototype.executeSingleInput = function (name, input) {\n    var opAttrs = [createTensorsTypeOpAttr('T', input.dtype)];\n    return this.executeSingleOutput(name, opAttrs, [input]);\n  };\n  /**\n   * Executes a TensorFlow Eager Op that provides one output Tensor.\n   * @param name The name of the Op to execute.\n   * @param opAttrs The list of Op attributes required to execute.\n   * @param inputs The list of input Tensors for the Op.\n   * @return A resulting Tensor from Op execution.\n   */\n  NodeJSKernelBackend.prototype.executeSingleOutput = function (name, opAttrs, inputs) {\n    var outputMetadata = this.binding.executeOp(name, opAttrs, this.getInputTensorIds(inputs), 1);\n    return this.createOutputTensor(outputMetadata[0]);\n  };\n  /**\n   * Executes a TensorFlow Eager Op that provides multiple output Tensors.\n   * @param name The name of the Op to execute.\n   * @param opAttrs The list of Op attributes required to execute.\n   * @param inputs The list of input Tensors for the Op.\n   * @param numOutputs The number of output Tensors for Op execution.\n   * @return A resulting Tensor array from Op execution.\n   */\n  NodeJSKernelBackend.prototype.executeMultipleOutputs = function (name, opAttrs, inputs, numOutputs) {\n    var _this = this;\n    var outputMetadata = this.binding.executeOp(name, opAttrs, this.getInputTensorIds(inputs), numOutputs);\n    return outputMetadata.map(function (m) {\n      return _this.createOutputTensor(m);\n    });\n  };\n  NodeJSKernelBackend.prototype.numDataIds = function () {\n    return this.tensorMap.numDataIds();\n  };\n  NodeJSKernelBackend.prototype.dispose = function () {};\n  NodeJSKernelBackend.prototype.read = function (dataId) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2 /*return*/, this.readSync(dataId)];\n      });\n    });\n  };\n  NodeJSKernelBackend.prototype.readSync = function (dataId) {\n    if (!this.tensorMap.has(dataId)) {\n      throw new Error(\"Tensor \" + dataId + \" was not registered!\");\n    }\n    var info = this.tensorMap.get(dataId);\n    if (info.values != null) {\n      return info.values;\n    } else {\n      return this.binding.tensorDataSync(info.id);\n    }\n  };\n  /**\n   * Dispose the memory if the dataId has 0 refCount. Return true if the memory\n   * is released, false otherwise.\n   * @param dataId\n   * @oaram force Optional, remove the data regardless of refCount\n   */\n  NodeJSKernelBackend.prototype.disposeData = function (dataId, force) {\n    if (force === void 0) {\n      force = false;\n    }\n    // No-op if already disposed.\n    if (this.tensorMap.has(dataId)) {\n      var id = this.tensorMap.get(dataId).id;\n      this.tensorMap.get(dataId).refCount--;\n      if (!force && this.tensorMap.get(dataId).refCount > 0) {\n        return false;\n      }\n      if (id != null && id >= 0) {\n        this.binding.deleteTensor(id);\n      }\n      this.tensorMap.delete(dataId);\n    }\n    return true;\n  };\n  /** Return refCount of a `TensorData`. */\n  NodeJSKernelBackend.prototype.refCount = function (dataId) {\n    if (this.tensorMap.has(dataId)) {\n      var tensorData = this.tensorMap.get(dataId);\n      return tensorData.refCount;\n    }\n    return 0;\n  };\n  NodeJSKernelBackend.prototype.incRef = function (dataId) {\n    this.tensorMap.get(dataId).refCount++;\n  };\n  NodeJSKernelBackend.prototype.move = function (dataId, values, shape, dtype, refCount) {\n    this.tensorMap.set(dataId, {\n      shape: shape,\n      dtype: getTFDType(dtype),\n      values: values,\n      id: -1,\n      refCount: refCount\n    });\n  };\n  NodeJSKernelBackend.prototype.write = function (values, shape, dtype) {\n    var dataId = {};\n    this.move(dataId, values, shape, dtype, 1);\n    return dataId;\n  };\n  NodeJSKernelBackend.prototype.applyActivation = function (input, activation, preluActivationWeights, leakyreluAlpha) {\n    var result = input;\n    if (activation != null) {\n      if (activation === 'linear') {\n        // No-op\n      } else if (activation === 'relu') {\n        result = tf.relu(result);\n      } else if (activation === 'prelu') {\n        result = tf.prelu(result, preluActivationWeights);\n      } else if (activation === 'leakyrelu') {\n        result = tf.leakyRelu(result, leakyreluAlpha);\n      } else if (activation === 'elu') {\n        result = tf.elu(result);\n      } else if (activation === 'relu6') {\n        result = tf.relu6(result);\n      } else if (activation === 'sigmoid') {\n        result = tf.sigmoid(result);\n      } else {\n        throw new Error(\"Activation: \" + activation + \" has not been implemented for the Node.js backend\");\n      }\n    }\n    return result;\n  };\n  NodeJSKernelBackend.prototype.divide = function (a, b) {\n    var opAttrs = [createTensorsTypeOpAttr('T', tfjs_1.backend_util.upcastType(a.dtype, b.dtype))];\n    return this.executeSingleOutput('Div', opAttrs, [a, b]);\n  };\n  NodeJSKernelBackend.prototype.divNoNan = function (a, b) {\n    var opAttrs = [createTensorsTypeOpAttr('T', tfjs_1.backend_util.upcastType(a.dtype, b.dtype))];\n    return this.executeSingleOutput('DivNoNan', opAttrs, [a, b]);\n  };\n  NodeJSKernelBackend.prototype.where = function (condition) {\n    return this.executeSingleOutput('Where', [], [condition]);\n  };\n  NodeJSKernelBackend.prototype.topKValues = function (x, k) {\n    throw new Error('Method not implemented.');\n  };\n  NodeJSKernelBackend.prototype.topKIndices = function (x, k) {\n    throw new Error('Method not implemented.');\n  };\n  NodeJSKernelBackend.prototype.int = function (x) {\n    throw new Error('Method not implemented.');\n  };\n  NodeJSKernelBackend.prototype.decodeJpeg = function (contents, channels, ratio, fancyUpscaling, tryRecoverTruncated, acceptableFraction, dctMethod) {\n    var opAttrs = [{\n      name: 'channels',\n      type: this.binding.TF_ATTR_INT,\n      value: channels\n    }, {\n      name: 'ratio',\n      type: this.binding.TF_ATTR_INT,\n      value: ratio\n    }, {\n      name: 'fancy_upscaling',\n      type: this.binding.TF_ATTR_BOOL,\n      value: fancyUpscaling\n    }, {\n      name: 'try_recover_truncated',\n      type: this.binding.TF_ATTR_BOOL,\n      value: tryRecoverTruncated\n    }, {\n      name: 'acceptable_fraction',\n      type: this.binding.TF_ATTR_FLOAT,\n      value: acceptableFraction\n    }, {\n      name: 'dct_method',\n      type: this.binding.TF_ATTR_STRING,\n      value: dctMethod\n    }];\n    var inputArgs = [tfjs_1.scalar(contents, 'string')];\n    return this.executeSingleOutput('DecodeJpeg', opAttrs, inputArgs);\n  };\n  NodeJSKernelBackend.prototype.decodePng = function (contents, channels) {\n    var opAttrs = [{\n      name: 'channels',\n      type: this.binding.TF_ATTR_INT,\n      value: channels\n    }];\n    var inputArgs = [tfjs_1.scalar(contents, 'string')];\n    return this.executeSingleOutput('DecodePng', opAttrs, inputArgs);\n  };\n  NodeJSKernelBackend.prototype.decodeBmp = function (contents, channels) {\n    var opAttrs = [{\n      name: 'channels',\n      type: this.binding.TF_ATTR_INT,\n      value: channels\n    }];\n    var inputArgs = [tfjs_1.scalar(contents, 'string')];\n    return this.executeSingleOutput('DecodeBmp', opAttrs, inputArgs);\n  };\n  NodeJSKernelBackend.prototype.decodeGif = function (contents) {\n    var inputArgs = [tfjs_1.scalar(contents, 'string')];\n    return this.executeSingleOutput('DecodeGif', [], inputArgs);\n  };\n  NodeJSKernelBackend.prototype.executeEncodeImageOp = function (name, opAttrs, imageData, imageShape) {\n    var inputTensorId = this.binding.createTensor(imageShape, this.binding.TF_UINT8, imageData);\n    var outputMetadata = this.binding.executeOp(name, opAttrs, [inputTensorId], 1);\n    var outputTensorInfo = outputMetadata[0];\n    // prevent the tensor data from being converted to a UTF8 string, since\n    // the encoded data is not valid UTF8\n    outputTensorInfo.dtype = this.binding.TF_UINT8;\n    return this.createOutputTensor(outputTensorInfo);\n  };\n  NodeJSKernelBackend.prototype.encodeJpeg = function (imageData, imageShape, format, quality, progressive, optimizeSize, chromaDownsampling, densityUnit, xDensity, yDensity, xmpMetadata) {\n    var opAttrs = [{\n      name: 'format',\n      type: this.binding.TF_ATTR_STRING,\n      value: format\n    }, {\n      name: 'quality',\n      type: this.binding.TF_ATTR_INT,\n      value: quality\n    }, {\n      name: 'progressive',\n      type: this.binding.TF_ATTR_BOOL,\n      value: progressive\n    }, {\n      name: 'optimize_size',\n      type: this.binding.TF_ATTR_BOOL,\n      value: optimizeSize\n    }, {\n      name: 'chroma_downsampling',\n      type: this.binding.TF_ATTR_BOOL,\n      value: chromaDownsampling\n    }, {\n      name: 'density_unit',\n      type: this.binding.TF_ATTR_STRING,\n      value: densityUnit\n    }, {\n      name: 'x_density',\n      type: this.binding.TF_ATTR_INT,\n      value: xDensity\n    }, {\n      name: 'y_density',\n      type: this.binding.TF_ATTR_INT,\n      value: yDensity\n    }, {\n      name: 'xmp_metadata',\n      type: this.binding.TF_ATTR_STRING,\n      value: xmpMetadata\n    }];\n    return this.executeEncodeImageOp('EncodeJpeg', opAttrs, imageData, imageShape);\n  };\n  NodeJSKernelBackend.prototype.encodePng = function (imageData, imageShape, compression) {\n    var opAttrs = [{\n      name: 'compression',\n      type: this.binding.TF_ATTR_INT,\n      value: compression\n    }];\n    return this.executeEncodeImageOp('EncodePng', opAttrs, imageData, imageShape);\n  };\n  NodeJSKernelBackend.prototype.deleteSavedModel = function (id) {\n    this.binding.deleteSavedModel(id);\n  };\n  NodeJSKernelBackend.prototype.loadSavedModelMetaGraph = function (path, tags) {\n    return this.binding.loadSavedModel(path, tags);\n  };\n  NodeJSKernelBackend.prototype.getMappedInputTensorIds = function (inputs, inputTensorInfos) {\n    var tensorIds = this.getInputTensorIds(inputs);\n    for (var i = 0; i < inputs.length; i++) {\n      if (inputTensorInfos[i] != null) {\n        if (inputTensorInfos[i].tfDtype === 'DT_UINT8') {\n          var data = Uint8Array.from(inputs[i].dataSync());\n          var inputTensorId = this.binding.createTensor(inputs[i].shape, this.binding.TF_UINT8, data);\n          tensorIds[i] = inputTensorId;\n        } else if (inputTensorInfos[i].tfDtype === 'DT_INT64') {\n          var data = int64_tensors_1.encodeInt32ArrayAsInt64(inputs[i].dataSync());\n          var inputTensorId = this.binding.createTensor(inputs[i].shape, this.binding.TF_INT64, data);\n          tensorIds[i] = inputTensorId;\n        }\n      }\n    }\n    return tensorIds;\n  };\n  NodeJSKernelBackend.prototype.runSavedModel = function (id, inputs, inputTensorInfos, outputOpNames) {\n    var _this = this;\n    var outputMetadata = this.binding.runSavedModel(id, this.getMappedInputTensorIds(inputs, inputTensorInfos), inputTensorInfos.map(function (info) {\n      return info.name;\n    }).join(','), outputOpNames.join(','));\n    return outputMetadata.map(function (m) {\n      return _this.createOutputTensor(m);\n    });\n  };\n  // ------------------------------------------------------------\n  // TensorBoard-related (tfjs-node-specific) backend kernels.\n  NodeJSKernelBackend.prototype.summaryWriter = function (logdir) {\n    var opAttrs = [{\n      name: 'shared_name',\n      type: this.binding.TF_ATTR_STRING,\n      value: \"logdir:\" + logdir\n    }, {\n      name: 'container',\n      type: this.binding.TF_ATTR_STRING,\n      value: ''\n    }];\n    var writerResource = this.executeSingleOutput('SummaryWriter', opAttrs, []);\n    return writerResource;\n  };\n  NodeJSKernelBackend.prototype.createSummaryFileWriter = function (resourceHandle, logdir, maxQueue, flushMillis, filenameSuffix) {\n    var inputArgs = [resourceHandle, tfjs_1.scalar(logdir), tfjs_1.scalar(maxQueue == null ? 10 : maxQueue, 'int32'), tfjs_1.scalar(flushMillis == null ? 2 * 60 * 1000 : flushMillis, 'int32'), tfjs_1.scalar(filenameSuffix == null ? '.v2' : filenameSuffix)];\n    this.executeMultipleOutputs('CreateSummaryFileWriter', [], inputArgs, 0);\n  };\n  NodeJSKernelBackend.prototype.writeScalarSummary = function (resourceHandle, step, name, value) {\n    var _this = this;\n    tfjs_1.tidy(function () {\n      tfjs_1.util.assert(Number.isInteger(step), function () {\n        return \"step is expected to be an integer, but is instead \" + step;\n      });\n      var inputArgs = [resourceHandle, new int64_tensors_1.Int64Scalar(step), tfjs_1.scalar(name, 'string')];\n      var typeAttr;\n      if (typeof value === 'number') {\n        inputArgs.push(tfjs_1.scalar(value));\n        typeAttr = _this.binding.TF_FLOAT;\n      } else {\n        // `value` is a Scalar.\n        tfjs_1.util.assert(value.rank === 0, function () {\n          return \"A non-scalar tensor (rank \" + value.rank + \") is passed to \" + \"writeScalarSummary()\";\n        });\n        inputArgs.push(value);\n        typeAttr = _this.typeAttributeFromTensor(value);\n      }\n      var opAttrs = [{\n        name: 'T',\n        type: _this.binding.TF_ATTR_TYPE,\n        value: typeAttr\n      }];\n      _this.binding.executeOp('WriteScalarSummary', opAttrs, _this.getInputTensorIds(inputArgs), 0);\n    });\n  };\n  NodeJSKernelBackend.prototype.writeHistogramSummary = function (resourceHandle, step, name, data, bucketCount, description) {\n    var _this = this;\n    tfjs_1.tidy(function () {\n      tfjs_1.util.assert(Number.isInteger(step), function () {\n        return \"step is expected to be an integer, but is instead \" + step;\n      });\n      // We use the WriteSummary op, and not WriteHistogramSummary. The\n      // difference is that WriteHistogramSummary takes a tensor of any shape,\n      // and places the values in 30 buckets, while WriteSummary expects a\n      // tensor which already describes the bucket widths and counts.\n      //\n      // If we were to use WriteHistogramSummary, we wouldn't have to implement\n      // the \"bucketization\" of the input tensor, but we also wouldn't have\n      // control over the number of buckets, or the description of the graph.\n      //\n      // Therefore, we instead use WriteSummary, which makes it possible to\n      // support these features. However, the trade-off is that we have to\n      // implement our own \"bucketization\", and have to write the summary as a\n      // protobuf message.\n      var content = new messages.HistogramPluginData().setVersion(0);\n      var pluginData = new messages.SummaryMetadata.PluginData().setPluginName('histograms').setContent(content.serializeBinary());\n      var summary = new messages.SummaryMetadata().setPluginData(pluginData).setDisplayName(null).setSummaryDescription(description);\n      var summaryTensor = tfjs_1.scalar(summary.serializeBinary(), 'string');\n      var nameTensor = tfjs_1.scalar(name, 'string');\n      var stepScalar = new int64_tensors_1.Int64Scalar(step);\n      var buckets = _this.buckets(data, bucketCount);\n      tfjs_1.util.assert(buckets.rank === 2 && buckets.shape[1] === 3, function () {\n        return \"Expected buckets to have shape [k, 3], but they had shape \" + buckets.shape;\n      });\n      tfjs_1.util.assert(buckets.dtype === 'float32', function () {\n        return \"Expected buckets to have dtype float32, but they had dtype \" + buckets.dtype;\n      });\n      var inputArgs = [resourceHandle, stepScalar, buckets, nameTensor, summaryTensor];\n      var typeAttr = _this.typeAttributeFromTensor(buckets);\n      var opAttrs = [{\n        name: 'T',\n        type: _this.binding.TF_ATTR_TYPE,\n        value: typeAttr\n      }];\n      _this.binding.executeOp('WriteSummary', opAttrs, _this.getInputTensorIds(inputArgs), 0);\n    });\n  };\n  NodeJSKernelBackend.prototype.flushSummaryWriter = function (resourceHandle) {\n    var inputArgs = [resourceHandle];\n    this.executeMultipleOutputs('FlushSummaryWriter', [], inputArgs, 0);\n  };\n  /**\n   * Group data into histogram buckets.\n   *\n   * @param data A `Tensor` of any shape. Must be castable to `float32`\n   * @param bucketCount Optional positive `number`\n   * @returns A `Tensor` of shape `[k, 3]` and type `float32`. The `i`th row is\n   *   a triple `[leftEdge, rightEdge, count]` for a single bucket. The value of\n   *   `k` is either `bucketCount`, `1` or `0`.\n   */\n  NodeJSKernelBackend.prototype.buckets = function (data, bucketCount) {\n    if (data.size === 0) {\n      return tf.tensor([], [0, 3], 'float32');\n    }\n    // 30 is the default number of buckets in the TensorFlow Python\n    // implementation. See\n    // https://github.com/tensorflow/tensorboard/blob/master/tensorboard/plugins/histogram/summary_v2.py\n    bucketCount = bucketCount !== undefined ? bucketCount : 30;\n    tfjs_1.util.assert(Number.isInteger(bucketCount) && bucketCount > 0, function () {\n      return \"Expected bucket count to be a strictly positive integer, but it was \" + (\"\" + bucketCount);\n    });\n    data = data.flatten();\n    data = data.cast('float32');\n    var min = data.min();\n    var max = data.max();\n    var range = max.sub(min);\n    var isSingular = range.equal(0).arraySync() !== 0;\n    if (isSingular) {\n      var center = min;\n      var bucketStart = center.sub(0.5);\n      var bucketEnd = center.add(0.5);\n      var bucketCounts_1 = tf.scalar(data.size, 'float32');\n      return tf.concat([bucketStart, bucketEnd, bucketCounts_1]).reshape([1, 3]);\n    }\n    var bucketWidth = range.div(bucketCount);\n    var offsets = data.sub(min);\n    var bucketIndices = offsets.floorDiv(bucketWidth).cast('int32');\n    var clampedIndices = tf.minimum(bucketIndices, bucketCount - 1).cast('int32');\n    var oneHots = tf.oneHot(clampedIndices, bucketCount);\n    var bucketCounts = oneHots.sum(0).cast('int32');\n    var edges = tf.linspace(min.arraySync(), max.arraySync(), bucketCount + 1);\n    // Ensure last value in edges is max (TF's linspace op doesn't do this)\n    edges = tf.concat([edges.slice(0, bucketCount), max.reshape([1])], 0);\n    var leftEdges = edges.slice(0, bucketCount);\n    var rightEdges = edges.slice(1, bucketCount);\n    return tf.stack([leftEdges, rightEdges, bucketCounts.cast('float32')]).transpose();\n  };\n  // ~ TensorBoard-related (tfjs-node-specific) backend kernels.\n  // ------------------------------------------------------------\n  NodeJSKernelBackend.prototype.memory = function () {\n    // Due to automatic garbage collection, the numbers are unreliable.\n    // TODO(kreeger): Since there is finalization in C, count the true\n    // number of undisposed tensors.\n    return {\n      unreliable: true\n    };\n  };\n  NodeJSKernelBackend.prototype.time = function (f) {\n    return __awaiter(this, void 0, void 0, function () {\n      var start, elapsed;\n      return __generator(this, function (_a) {\n        start = process.hrtime();\n        f();\n        elapsed = process.hrtime(start);\n        return [2 /*return*/, {\n          kernelMs: elapsed[0] * 1000 + elapsed[1] / 1000000\n        }];\n      });\n    });\n  };\n  NodeJSKernelBackend.prototype.getNumOfSavedModels = function () {\n    return this.binding.getNumOfSavedModels();\n  };\n  return NodeJSKernelBackend;\n}(tfjs_1.KernelBackend);\nexports.NodeJSKernelBackend = NodeJSKernelBackend;\n/** Returns an instance of the Node.js backend. */\nfunction nodeBackend() {\n  return tf.findBackend('tensorflow');\n}\nexports.nodeBackend = nodeBackend;\n/** Returns the TF dtype for a given DataType. */\nfunction getTFDType(dataType) {\n  var binding = nodeBackend().binding;\n  switch (dataType) {\n    case 'float32':\n      return binding.TF_FLOAT;\n    case 'int32':\n      return binding.TF_INT32;\n    case 'bool':\n      return binding.TF_BOOL;\n    case 'complex64':\n      return binding.TF_COMPLEX64;\n    case 'string':\n      return binding.TF_STRING;\n    // tslint:disable-next-line:no-any\n    case 'int64':\n      // int64 is not a generally supported dtype in TensorFlow.js\n      // (tfjs-core). However, it needs to be included here for the purpose of\n      // writing the `step` value to TensorBoard via WriteScalarSummary and\n      // other op kernels.\n      return binding.TF_INT64;\n    default:\n      var errorMessage = \"Unknown dtype: \" + dataType;\n      throw new Error(errorMessage);\n  }\n}\nexports.getTFDType = getTFDType;\n/**\n * Creates a TFEOpAttr for a 'type' OpDef attribute from a Tensor or list of\n * Tensors.\n */\nfunction createTensorsTypeOpAttr(attrName, tensorsOrDtype) {\n  if (util_1.isNullOrUndefined(tensorsOrDtype)) {\n    throw new Error('Invalid input tensors value.');\n  }\n  return {\n    name: attrName,\n    type: nodeBackend().binding.TF_ATTR_TYPE,\n    value: tensorsOrDtype instanceof tf.Tensor || Array.isArray(tensorsOrDtype) ? getTFDTypeForInputs(tensorsOrDtype) : getTFDType(tensorsOrDtype)\n  };\n}\nexports.createTensorsTypeOpAttr = createTensorsTypeOpAttr;\n// TODO(yassogba) remove? who uses this?\nfunction createOpAttr(attrName, tensorsOrDtype, value) {\n  if (util_1.isNullOrUndefined(tensorsOrDtype)) {\n    throw new Error('Invalid input tensors value.');\n  }\n  return {\n    name: attrName,\n    type: nodeBackend().binding.TF_BOOL,\n    value: value\n  };\n}\nexports.createOpAttr = createOpAttr;\n/** Returns the dtype number for a single or list of input Tensors. */\nfunction getTFDTypeForInputs(tensors) {\n  if (util_1.isNullOrUndefined(tensors)) {\n    throw new Error('Invalid input tensors value.');\n  }\n  if (util_1.isArray(tensors)) {\n    for (var i = 0; i < tensors.length; i++) {\n      return getTFDType(tensors[i].dtype);\n    }\n    return -1;\n  } else {\n    return getTFDType(tensors.dtype);\n  }\n}\nfunction ensureTensorflowBackend() {\n  tf.util.assert(tf.getBackend() === 'tensorflow', function () {\n    return \"Expect the current backend to be \\\"tensorflow\\\", but got \\\"\" + tf.getBackend() + \"\\\"\";\n  });\n}\nexports.ensureTensorflowBackend = ensureTensorflowBackend;","map":{"version":3,"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","defineProperty","exports","tf","require","tfjs_1","util_1","int64_tensors_1","messages","NodeJSKernelBackend","_super","binding","packageName","_this","isGPUPackage","isUsingGpuDevice","tensorMap","DataStorage","engine","getDTypeInteger","dtype","TF_FLOAT","TF_INT32","TF_BOOL","TF_COMPLEX64","TF_STRING","Error","typeAttributeFromTensor","createOutputTensor","metadata","newId","set","shape","id","values","refCount","TF_INT64","console","warn","TF_RESOURCE","TF_UINT8","tensorInfo","dataId","makeTensorFromTensorInfo","getInputTensorIds","tensors","ids","i","Int64Scalar","valueArray","createTensor","info","get","createReductionOpAttrs","tensor","keepDims","name","type","TF_ATTR_BOOL","createTensorsTypeOpAttr","floatPrecision","epsilon","executeSingleInput","input","opAttrs","executeSingleOutput","inputs","outputMetadata","executeOp","executeMultipleOutputs","numOutputs","map","m","numDataIds","dispose","read","_a","readSync","has","tensorDataSync","disposeData","force","deleteTensor","delete","tensorData","incRef","move","getTFDType","write","applyActivation","activation","preluActivationWeights","leakyreluAlpha","relu","prelu","leakyRelu","elu","relu6","sigmoid","divide","a","backend_util","upcastType","divNoNan","where","condition","topKValues","x","k","topKIndices","int","decodeJpeg","contents","channels","ratio","fancyUpscaling","tryRecoverTruncated","acceptableFraction","dctMethod","TF_ATTR_INT","TF_ATTR_FLOAT","TF_ATTR_STRING","inputArgs","scalar","decodePng","decodeBmp","decodeGif","executeEncodeImageOp","imageData","imageShape","inputTensorId","outputTensorInfo","encodeJpeg","format","quality","progressive","optimizeSize","chromaDownsampling","densityUnit","xDensity","yDensity","xmpMetadata","encodePng","compression","deleteSavedModel","loadSavedModelMetaGraph","path","tags","loadSavedModel","getMappedInputTensorIds","inputTensorInfos","tensorIds","tfDtype","data","Uint8Array","from","dataSync","encodeInt32ArrayAsInt64","runSavedModel","outputOpNames","join","summaryWriter","logdir","writerResource","createSummaryFileWriter","resourceHandle","maxQueue","flushMillis","filenameSuffix","writeScalarSummary","tidy","util","assert","Number","isInteger","typeAttr","rank","TF_ATTR_TYPE","writeHistogramSummary","bucketCount","description","content","HistogramPluginData","setVersion","pluginData","SummaryMetadata","PluginData","setPluginName","setContent","serializeBinary","summary","setPluginData","setDisplayName","setSummaryDescription","summaryTensor","nameTensor","stepScalar","buckets","flushSummaryWriter","size","undefined","flatten","cast","min","max","range","sub","isSingular","equal","arraySync","center","bucketStart","bucketEnd","add","bucketCounts_1","concat","reshape","bucketWidth","div","offsets","bucketIndices","floorDiv","clampedIndices","minimum","oneHots","oneHot","bucketCounts","sum","edges","linspace","slice","leftEdges","rightEdges","stack","transpose","memory","unreliable","time","start","elapsed","process","hrtime","kernelMs","getNumOfSavedModels","KernelBackend","nodeBackend","findBackend","dataType","errorMessage","attrName","tensorsOrDtype","isNullOrUndefined","Tensor","isArray","getTFDTypeForInputs","createOpAttr","ensureTensorflowBackend","getBackend"],"sources":["C:/Users/ACER/node_modules/@tensorflow/tfjs-node/dist/nodejs_kernel_backend.js"],"sourcesContent":["\"use strict\";\n/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tf = require(\"@tensorflow/tfjs\");\nvar tfjs_1 = require(\"@tensorflow/tfjs\");\nvar util_1 = require(\"util\");\nvar int64_tensors_1 = require(\"./int64_tensors\");\n// tslint:disable-next-line:no-require-imports\nvar messages = require('./proto/api_pb');\nvar NodeJSKernelBackend = /** @class */ (function (_super) {\n    __extends(NodeJSKernelBackend, _super);\n    function NodeJSKernelBackend(binding, packageName) {\n        var _this = _super.call(this) || this;\n        _this.binding = binding;\n        _this.isGPUPackage = packageName === '@tensorflow/tfjs-node-gpu';\n        _this.isUsingGpuDevice = _this.binding.isUsingGpuDevice();\n        _this.tensorMap = new tf.DataStorage(_this, tf.engine());\n        return _this;\n    }\n    NodeJSKernelBackend.prototype.getDTypeInteger = function (dtype) {\n        switch (dtype) {\n            case 'float32':\n                return this.binding.TF_FLOAT;\n            case 'int32':\n                return this.binding.TF_INT32;\n            case 'bool':\n                return this.binding.TF_BOOL;\n            case 'complex64':\n                return this.binding.TF_COMPLEX64;\n            case 'string':\n                return this.binding.TF_STRING;\n            default:\n                throw new Error(\"Unsupported DType: \" + dtype);\n        }\n    };\n    NodeJSKernelBackend.prototype.typeAttributeFromTensor = function (value) {\n        return this.getDTypeInteger(value.dtype);\n    };\n    // Creates a new Tensor and maps the dataId to the passed in ID.\n    NodeJSKernelBackend.prototype.createOutputTensor = function (metadata) {\n        var newId = {};\n        this.tensorMap.set(newId, {\n            shape: metadata.shape,\n            dtype: metadata.dtype,\n            id: metadata.id,\n            values: null,\n            refCount: 1\n        });\n        var dtype;\n        switch (metadata.dtype) {\n            case this.binding.TF_FLOAT:\n                dtype = 'float32';\n                break;\n            case this.binding.TF_INT32:\n                dtype = 'int32';\n                break;\n            case this.binding.TF_INT64:\n                console.warn('INT64 output tensor will be stored as BigInt64Array.');\n                // INT64 is not supported in TFJS yet, cast it to int32.\n                dtype = 'int32';\n                break;\n            case this.binding.TF_BOOL:\n                dtype = 'bool';\n                break;\n            case this.binding.TF_COMPLEX64:\n                dtype = 'complex64';\n                break;\n            case this.binding.TF_STRING:\n                dtype = 'string';\n                break;\n            case this.binding.TF_RESOURCE:\n                // NOTE(cais): We currently represent resource-type Tensors\n                // as string of ubytes.\n                dtype = 'string';\n                break;\n            case this.binding.TF_UINT8:\n                // TensorFlow uses UINT8 as dtype for image tensor. UINT8 is not\n                // supported in TFJS yet, cast it to int32.\n                dtype = 'int32';\n                break;\n            default:\n                throw new Error(\"Unknown dtype enum \" + metadata.dtype);\n        }\n        // TODO(yassogba) Enable this once all the kernels are removed from backend.\n        // We can then change the return type from Tensor to TensorInfo.\n        // return {dataId: newId, shape: metadata.shape, dtype};\n        var tensorInfo = {\n            dataId: newId, shape: metadata.shape, dtype: dtype\n        };\n        return tf.engine().makeTensorFromTensorInfo(tensorInfo);\n    };\n    // Prepares Tensor instances for Op execution.\n    NodeJSKernelBackend.prototype.getInputTensorIds = function (tensors) {\n        var ids = [];\n        for (var i = 0; i < tensors.length; i++) {\n            if (tensors[i] instanceof int64_tensors_1.Int64Scalar) {\n                // Then `tensors[i]` is a Int64Scalar, which we currently represent\n                // using an `Int32Array`.\n                var value = tensors[i].valueArray;\n                var id = this.binding.createTensor([], this.binding.TF_INT64, value);\n                ids.push(id);\n            }\n            else {\n                var info = this.tensorMap.get(tensors[i].dataId);\n                // TODO - what about ID in this case? Handle in write()??\n                if (info.values != null) {\n                    // Values were delayed to write into the TensorHandle. Do that before\n                    // Op execution and clear stored values.\n                    info.id =\n                        this.binding.createTensor(info.shape, info.dtype, info.values);\n                    info.values = null;\n                }\n                ids.push(info.id);\n            }\n        }\n        return ids;\n    };\n    NodeJSKernelBackend.prototype.createReductionOpAttrs = function (tensor, keepDims) {\n        if (keepDims === void 0) { keepDims = false; }\n        return [\n            { name: 'keep_dims', type: this.binding.TF_ATTR_BOOL, value: keepDims },\n            createTensorsTypeOpAttr('T', tensor.dtype),\n            createTensorsTypeOpAttr('Tidx', 'int32')\n        ];\n    };\n    NodeJSKernelBackend.prototype.floatPrecision = function () {\n        return 32;\n    };\n    NodeJSKernelBackend.prototype.epsilon = function () {\n        return _super.prototype.epsilon.call(this);\n    };\n    /**\n     * Executes an op that has a single input and output.\n     *\n     * Helper function to wrap executeSingleOutput in a particular case.\n     * @param name The name of the Op to execute.\n     * @param input The input Tensor for the Op.\n     */\n    NodeJSKernelBackend.prototype.executeSingleInput = function (name, input) {\n        var opAttrs = [createTensorsTypeOpAttr('T', input.dtype)];\n        return this.executeSingleOutput(name, opAttrs, [input]);\n    };\n    /**\n     * Executes a TensorFlow Eager Op that provides one output Tensor.\n     * @param name The name of the Op to execute.\n     * @param opAttrs The list of Op attributes required to execute.\n     * @param inputs The list of input Tensors for the Op.\n     * @return A resulting Tensor from Op execution.\n     */\n    NodeJSKernelBackend.prototype.executeSingleOutput = function (name, opAttrs, inputs) {\n        var outputMetadata = this.binding.executeOp(name, opAttrs, this.getInputTensorIds(inputs), 1);\n        return this.createOutputTensor(outputMetadata[0]);\n    };\n    /**\n     * Executes a TensorFlow Eager Op that provides multiple output Tensors.\n     * @param name The name of the Op to execute.\n     * @param opAttrs The list of Op attributes required to execute.\n     * @param inputs The list of input Tensors for the Op.\n     * @param numOutputs The number of output Tensors for Op execution.\n     * @return A resulting Tensor array from Op execution.\n     */\n    NodeJSKernelBackend.prototype.executeMultipleOutputs = function (name, opAttrs, inputs, numOutputs) {\n        var _this = this;\n        var outputMetadata = this.binding.executeOp(name, opAttrs, this.getInputTensorIds(inputs), numOutputs);\n        return outputMetadata.map(function (m) { return _this.createOutputTensor(m); });\n    };\n    NodeJSKernelBackend.prototype.numDataIds = function () {\n        return this.tensorMap.numDataIds();\n    };\n    NodeJSKernelBackend.prototype.dispose = function () { };\n    NodeJSKernelBackend.prototype.read = function (dataId) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.readSync(dataId)];\n            });\n        });\n    };\n    NodeJSKernelBackend.prototype.readSync = function (dataId) {\n        if (!this.tensorMap.has(dataId)) {\n            throw new Error(\"Tensor \" + dataId + \" was not registered!\");\n        }\n        var info = this.tensorMap.get(dataId);\n        if (info.values != null) {\n            return info.values;\n        }\n        else {\n            return this.binding.tensorDataSync(info.id);\n        }\n    };\n    /**\n     * Dispose the memory if the dataId has 0 refCount. Return true if the memory\n     * is released, false otherwise.\n     * @param dataId\n     * @oaram force Optional, remove the data regardless of refCount\n     */\n    NodeJSKernelBackend.prototype.disposeData = function (dataId, force) {\n        if (force === void 0) { force = false; }\n        // No-op if already disposed.\n        if (this.tensorMap.has(dataId)) {\n            var id = this.tensorMap.get(dataId).id;\n            this.tensorMap.get(dataId).refCount--;\n            if (!force && this.tensorMap.get(dataId).refCount > 0) {\n                return false;\n            }\n            if (id != null && id >= 0) {\n                this.binding.deleteTensor(id);\n            }\n            this.tensorMap.delete(dataId);\n        }\n        return true;\n    };\n    /** Return refCount of a `TensorData`. */\n    NodeJSKernelBackend.prototype.refCount = function (dataId) {\n        if (this.tensorMap.has(dataId)) {\n            var tensorData = this.tensorMap.get(dataId);\n            return tensorData.refCount;\n        }\n        return 0;\n    };\n    NodeJSKernelBackend.prototype.incRef = function (dataId) {\n        this.tensorMap.get(dataId).refCount++;\n    };\n    NodeJSKernelBackend.prototype.move = function (dataId, values, shape, dtype, refCount) {\n        this.tensorMap.set(dataId, { shape: shape, dtype: getTFDType(dtype), values: values, id: -1, refCount: refCount });\n    };\n    NodeJSKernelBackend.prototype.write = function (values, shape, dtype) {\n        var dataId = {};\n        this.move(dataId, values, shape, dtype, 1);\n        return dataId;\n    };\n    NodeJSKernelBackend.prototype.applyActivation = function (input, activation, preluActivationWeights, leakyreluAlpha) {\n        var result = input;\n        if (activation != null) {\n            if (activation === 'linear') {\n                // No-op\n            }\n            else if (activation === 'relu') {\n                result = tf.relu(result);\n            }\n            else if (activation === 'prelu') {\n                result = tf.prelu(result, preluActivationWeights);\n            }\n            else if (activation === 'leakyrelu') {\n                result = tf.leakyRelu(result, leakyreluAlpha);\n            }\n            else if (activation === 'elu') {\n                result = tf.elu(result);\n            }\n            else if (activation === 'relu6') {\n                result = tf.relu6(result);\n            }\n            else if (activation === 'sigmoid') {\n                result = tf.sigmoid(result);\n            }\n            else {\n                throw new Error(\"Activation: \" + activation + \" has not been implemented for the Node.js backend\");\n            }\n        }\n        return result;\n    };\n    NodeJSKernelBackend.prototype.divide = function (a, b) {\n        var opAttrs = [createTensorsTypeOpAttr('T', tfjs_1.backend_util.upcastType(a.dtype, b.dtype))];\n        return this.executeSingleOutput('Div', opAttrs, [a, b]);\n    };\n    NodeJSKernelBackend.prototype.divNoNan = function (a, b) {\n        var opAttrs = [createTensorsTypeOpAttr('T', tfjs_1.backend_util.upcastType(a.dtype, b.dtype))];\n        return this.executeSingleOutput('DivNoNan', opAttrs, [a, b]);\n    };\n    NodeJSKernelBackend.prototype.where = function (condition) {\n        return this.executeSingleOutput('Where', [], [condition]);\n    };\n    NodeJSKernelBackend.prototype.topKValues = function (x, k) {\n        throw new Error('Method not implemented.');\n    };\n    NodeJSKernelBackend.prototype.topKIndices = function (x, k) {\n        throw new Error('Method not implemented.');\n    };\n    NodeJSKernelBackend.prototype.int = function (x) {\n        throw new Error('Method not implemented.');\n    };\n    NodeJSKernelBackend.prototype.decodeJpeg = function (contents, channels, ratio, fancyUpscaling, tryRecoverTruncated, acceptableFraction, dctMethod) {\n        var opAttrs = [\n            { name: 'channels', type: this.binding.TF_ATTR_INT, value: channels },\n            { name: 'ratio', type: this.binding.TF_ATTR_INT, value: ratio }, {\n                name: 'fancy_upscaling',\n                type: this.binding.TF_ATTR_BOOL,\n                value: fancyUpscaling\n            },\n            {\n                name: 'try_recover_truncated',\n                type: this.binding.TF_ATTR_BOOL,\n                value: tryRecoverTruncated\n            },\n            {\n                name: 'acceptable_fraction',\n                type: this.binding.TF_ATTR_FLOAT,\n                value: acceptableFraction\n            },\n            { name: 'dct_method', type: this.binding.TF_ATTR_STRING, value: dctMethod }\n        ];\n        var inputArgs = [tfjs_1.scalar(contents, 'string')];\n        return this.executeSingleOutput('DecodeJpeg', opAttrs, inputArgs);\n    };\n    NodeJSKernelBackend.prototype.decodePng = function (contents, channels) {\n        var opAttrs = [{ name: 'channels', type: this.binding.TF_ATTR_INT, value: channels }];\n        var inputArgs = [tfjs_1.scalar(contents, 'string')];\n        return this.executeSingleOutput('DecodePng', opAttrs, inputArgs);\n    };\n    NodeJSKernelBackend.prototype.decodeBmp = function (contents, channels) {\n        var opAttrs = [{ name: 'channels', type: this.binding.TF_ATTR_INT, value: channels }];\n        var inputArgs = [tfjs_1.scalar(contents, 'string')];\n        return this.executeSingleOutput('DecodeBmp', opAttrs, inputArgs);\n    };\n    NodeJSKernelBackend.prototype.decodeGif = function (contents) {\n        var inputArgs = [tfjs_1.scalar(contents, 'string')];\n        return this.executeSingleOutput('DecodeGif', [], inputArgs);\n    };\n    NodeJSKernelBackend.prototype.executeEncodeImageOp = function (name, opAttrs, imageData, imageShape) {\n        var inputTensorId = this.binding.createTensor(imageShape, this.binding.TF_UINT8, imageData);\n        var outputMetadata = this.binding.executeOp(name, opAttrs, [inputTensorId], 1);\n        var outputTensorInfo = outputMetadata[0];\n        // prevent the tensor data from being converted to a UTF8 string, since\n        // the encoded data is not valid UTF8\n        outputTensorInfo.dtype = this.binding.TF_UINT8;\n        return this.createOutputTensor(outputTensorInfo);\n    };\n    NodeJSKernelBackend.prototype.encodeJpeg = function (imageData, imageShape, format, quality, progressive, optimizeSize, chromaDownsampling, densityUnit, xDensity, yDensity, xmpMetadata) {\n        var opAttrs = [\n            { name: 'format', type: this.binding.TF_ATTR_STRING, value: format },\n            { name: 'quality', type: this.binding.TF_ATTR_INT, value: quality }, {\n                name: 'progressive',\n                type: this.binding.TF_ATTR_BOOL,\n                value: progressive\n            },\n            {\n                name: 'optimize_size',\n                type: this.binding.TF_ATTR_BOOL,\n                value: optimizeSize\n            },\n            {\n                name: 'chroma_downsampling',\n                type: this.binding.TF_ATTR_BOOL,\n                value: chromaDownsampling\n            },\n            {\n                name: 'density_unit',\n                type: this.binding.TF_ATTR_STRING,\n                value: densityUnit\n            },\n            { name: 'x_density', type: this.binding.TF_ATTR_INT, value: xDensity },\n            { name: 'y_density', type: this.binding.TF_ATTR_INT, value: yDensity }, {\n                name: 'xmp_metadata',\n                type: this.binding.TF_ATTR_STRING,\n                value: xmpMetadata\n            }\n        ];\n        return this.executeEncodeImageOp('EncodeJpeg', opAttrs, imageData, imageShape);\n    };\n    NodeJSKernelBackend.prototype.encodePng = function (imageData, imageShape, compression) {\n        var opAttrs = [\n            { name: 'compression', type: this.binding.TF_ATTR_INT, value: compression }\n        ];\n        return this.executeEncodeImageOp('EncodePng', opAttrs, imageData, imageShape);\n    };\n    NodeJSKernelBackend.prototype.deleteSavedModel = function (id) {\n        this.binding.deleteSavedModel(id);\n    };\n    NodeJSKernelBackend.prototype.loadSavedModelMetaGraph = function (path, tags) {\n        return this.binding.loadSavedModel(path, tags);\n    };\n    NodeJSKernelBackend.prototype.getMappedInputTensorIds = function (inputs, inputTensorInfos) {\n        var tensorIds = this.getInputTensorIds(inputs);\n        for (var i = 0; i < inputs.length; i++) {\n            if (inputTensorInfos[i] != null) {\n                if (inputTensorInfos[i].tfDtype === 'DT_UINT8') {\n                    var data = Uint8Array.from(inputs[i].dataSync());\n                    var inputTensorId = this.binding.createTensor(inputs[i].shape, this.binding.TF_UINT8, data);\n                    tensorIds[i] = inputTensorId;\n                }\n                else if (inputTensorInfos[i].tfDtype === 'DT_INT64') {\n                    var data = int64_tensors_1.encodeInt32ArrayAsInt64(inputs[i].dataSync());\n                    var inputTensorId = this.binding.createTensor(inputs[i].shape, this.binding.TF_INT64, data);\n                    tensorIds[i] = inputTensorId;\n                }\n            }\n        }\n        return tensorIds;\n    };\n    NodeJSKernelBackend.prototype.runSavedModel = function (id, inputs, inputTensorInfos, outputOpNames) {\n        var _this = this;\n        var outputMetadata = this.binding.runSavedModel(id, this.getMappedInputTensorIds(inputs, inputTensorInfos), inputTensorInfos.map(function (info) { return info.name; }).join(','), outputOpNames.join(','));\n        return outputMetadata.map(function (m) { return _this.createOutputTensor(m); });\n    };\n    // ------------------------------------------------------------\n    // TensorBoard-related (tfjs-node-specific) backend kernels.\n    NodeJSKernelBackend.prototype.summaryWriter = function (logdir) {\n        var opAttrs = [\n            {\n                name: 'shared_name',\n                type: this.binding.TF_ATTR_STRING,\n                value: \"logdir:\" + logdir\n            },\n            { name: 'container', type: this.binding.TF_ATTR_STRING, value: '' }\n        ];\n        var writerResource = this.executeSingleOutput('SummaryWriter', opAttrs, []);\n        return writerResource;\n    };\n    NodeJSKernelBackend.prototype.createSummaryFileWriter = function (resourceHandle, logdir, maxQueue, flushMillis, filenameSuffix) {\n        var inputArgs = [\n            resourceHandle, tfjs_1.scalar(logdir),\n            tfjs_1.scalar(maxQueue == null ? 10 : maxQueue, 'int32'),\n            tfjs_1.scalar(flushMillis == null ? 2 * 60 * 1000 : flushMillis, 'int32'),\n            tfjs_1.scalar(filenameSuffix == null ? '.v2' : filenameSuffix)\n        ];\n        this.executeMultipleOutputs('CreateSummaryFileWriter', [], inputArgs, 0);\n    };\n    NodeJSKernelBackend.prototype.writeScalarSummary = function (resourceHandle, step, name, value) {\n        var _this = this;\n        tfjs_1.tidy(function () {\n            tfjs_1.util.assert(Number.isInteger(step), function () { return \"step is expected to be an integer, but is instead \" + step; });\n            var inputArgs = [resourceHandle, new int64_tensors_1.Int64Scalar(step), tfjs_1.scalar(name, 'string')];\n            var typeAttr;\n            if (typeof value === 'number') {\n                inputArgs.push(tfjs_1.scalar(value));\n                typeAttr = _this.binding.TF_FLOAT;\n            }\n            else {\n                // `value` is a Scalar.\n                tfjs_1.util.assert(value.rank === 0, function () { return \"A non-scalar tensor (rank \" + value.rank + \") is passed to \" +\n                    \"writeScalarSummary()\"; });\n                inputArgs.push(value);\n                typeAttr = _this.typeAttributeFromTensor(value);\n            }\n            var opAttrs = [{ name: 'T', type: _this.binding.TF_ATTR_TYPE, value: typeAttr }];\n            _this.binding.executeOp('WriteScalarSummary', opAttrs, _this.getInputTensorIds(inputArgs), 0);\n        });\n    };\n    NodeJSKernelBackend.prototype.writeHistogramSummary = function (resourceHandle, step, name, data, bucketCount, description) {\n        var _this = this;\n        tfjs_1.tidy(function () {\n            tfjs_1.util.assert(Number.isInteger(step), function () { return \"step is expected to be an integer, but is instead \" + step; });\n            // We use the WriteSummary op, and not WriteHistogramSummary. The\n            // difference is that WriteHistogramSummary takes a tensor of any shape,\n            // and places the values in 30 buckets, while WriteSummary expects a\n            // tensor which already describes the bucket widths and counts.\n            //\n            // If we were to use WriteHistogramSummary, we wouldn't have to implement\n            // the \"bucketization\" of the input tensor, but we also wouldn't have\n            // control over the number of buckets, or the description of the graph.\n            //\n            // Therefore, we instead use WriteSummary, which makes it possible to\n            // support these features. However, the trade-off is that we have to\n            // implement our own \"bucketization\", and have to write the summary as a\n            // protobuf message.\n            var content = new messages.HistogramPluginData().setVersion(0);\n            var pluginData = new messages.SummaryMetadata.PluginData()\n                .setPluginName('histograms')\n                .setContent(content.serializeBinary());\n            var summary = new messages.SummaryMetadata()\n                .setPluginData(pluginData)\n                .setDisplayName(null)\n                .setSummaryDescription(description);\n            var summaryTensor = tfjs_1.scalar(summary.serializeBinary(), 'string');\n            var nameTensor = tfjs_1.scalar(name, 'string');\n            var stepScalar = new int64_tensors_1.Int64Scalar(step);\n            var buckets = _this.buckets(data, bucketCount);\n            tfjs_1.util.assert(buckets.rank === 2 && buckets.shape[1] === 3, function () { return \"Expected buckets to have shape [k, 3], but they had shape \" + buckets.shape; });\n            tfjs_1.util.assert(buckets.dtype === 'float32', function () { return \"Expected buckets to have dtype float32, but they had dtype \" + buckets.dtype; });\n            var inputArgs = [resourceHandle, stepScalar, buckets, nameTensor, summaryTensor];\n            var typeAttr = _this.typeAttributeFromTensor(buckets);\n            var opAttrs = [{ name: 'T', type: _this.binding.TF_ATTR_TYPE, value: typeAttr }];\n            _this.binding.executeOp('WriteSummary', opAttrs, _this.getInputTensorIds(inputArgs), 0);\n        });\n    };\n    NodeJSKernelBackend.prototype.flushSummaryWriter = function (resourceHandle) {\n        var inputArgs = [resourceHandle];\n        this.executeMultipleOutputs('FlushSummaryWriter', [], inputArgs, 0);\n    };\n    /**\n     * Group data into histogram buckets.\n     *\n     * @param data A `Tensor` of any shape. Must be castable to `float32`\n     * @param bucketCount Optional positive `number`\n     * @returns A `Tensor` of shape `[k, 3]` and type `float32`. The `i`th row is\n     *   a triple `[leftEdge, rightEdge, count]` for a single bucket. The value of\n     *   `k` is either `bucketCount`, `1` or `0`.\n     */\n    NodeJSKernelBackend.prototype.buckets = function (data, bucketCount) {\n        if (data.size === 0) {\n            return tf.tensor([], [0, 3], 'float32');\n        }\n        // 30 is the default number of buckets in the TensorFlow Python\n        // implementation. See\n        // https://github.com/tensorflow/tensorboard/blob/master/tensorboard/plugins/histogram/summary_v2.py\n        bucketCount = bucketCount !== undefined ? bucketCount : 30;\n        tfjs_1.util.assert(Number.isInteger(bucketCount) && bucketCount > 0, function () {\n            return \"Expected bucket count to be a strictly positive integer, but it was \" +\n                (\"\" + bucketCount);\n        });\n        data = data.flatten();\n        data = data.cast('float32');\n        var min = data.min();\n        var max = data.max();\n        var range = max.sub(min);\n        var isSingular = range.equal(0).arraySync() !== 0;\n        if (isSingular) {\n            var center = min;\n            var bucketStart = center.sub(0.5);\n            var bucketEnd = center.add(0.5);\n            var bucketCounts_1 = tf.scalar(data.size, 'float32');\n            return tf.concat([bucketStart, bucketEnd, bucketCounts_1]).reshape([1, 3]);\n        }\n        var bucketWidth = range.div(bucketCount);\n        var offsets = data.sub(min);\n        var bucketIndices = offsets.floorDiv(bucketWidth).cast('int32');\n        var clampedIndices = tf.minimum(bucketIndices, bucketCount - 1).cast('int32');\n        var oneHots = tf.oneHot(clampedIndices, bucketCount);\n        var bucketCounts = oneHots.sum(0).cast('int32');\n        var edges = tf.linspace(min.arraySync(), max.arraySync(), bucketCount + 1);\n        // Ensure last value in edges is max (TF's linspace op doesn't do this)\n        edges = tf.concat([edges.slice(0, bucketCount), max.reshape([1])], 0);\n        var leftEdges = edges.slice(0, bucketCount);\n        var rightEdges = edges.slice(1, bucketCount);\n        return tf.stack([leftEdges, rightEdges, bucketCounts.cast('float32')])\n            .transpose();\n    };\n    // ~ TensorBoard-related (tfjs-node-specific) backend kernels.\n    // ------------------------------------------------------------\n    NodeJSKernelBackend.prototype.memory = function () {\n        // Due to automatic garbage collection, the numbers are unreliable.\n        // TODO(kreeger): Since there is finalization in C, count the true\n        // number of undisposed tensors.\n        return { unreliable: true };\n    };\n    NodeJSKernelBackend.prototype.time = function (f) {\n        return __awaiter(this, void 0, void 0, function () {\n            var start, elapsed;\n            return __generator(this, function (_a) {\n                start = process.hrtime();\n                f();\n                elapsed = process.hrtime(start);\n                return [2 /*return*/, { kernelMs: elapsed[0] * 1000 + elapsed[1] / 1000000 }];\n            });\n        });\n    };\n    NodeJSKernelBackend.prototype.getNumOfSavedModels = function () {\n        return this.binding.getNumOfSavedModels();\n    };\n    return NodeJSKernelBackend;\n}(tfjs_1.KernelBackend));\nexports.NodeJSKernelBackend = NodeJSKernelBackend;\n/** Returns an instance of the Node.js backend. */\nfunction nodeBackend() {\n    return tf.findBackend('tensorflow');\n}\nexports.nodeBackend = nodeBackend;\n/** Returns the TF dtype for a given DataType. */\nfunction getTFDType(dataType) {\n    var binding = nodeBackend().binding;\n    switch (dataType) {\n        case 'float32':\n            return binding.TF_FLOAT;\n        case 'int32':\n            return binding.TF_INT32;\n        case 'bool':\n            return binding.TF_BOOL;\n        case 'complex64':\n            return binding.TF_COMPLEX64;\n        case 'string':\n            return binding.TF_STRING;\n        // tslint:disable-next-line:no-any\n        case 'int64':\n            // int64 is not a generally supported dtype in TensorFlow.js\n            // (tfjs-core). However, it needs to be included here for the purpose of\n            // writing the `step` value to TensorBoard via WriteScalarSummary and\n            // other op kernels.\n            return binding.TF_INT64;\n        default:\n            var errorMessage = \"Unknown dtype: \" + dataType;\n            throw new Error(errorMessage);\n    }\n}\nexports.getTFDType = getTFDType;\n/**\n * Creates a TFEOpAttr for a 'type' OpDef attribute from a Tensor or list of\n * Tensors.\n */\nfunction createTensorsTypeOpAttr(attrName, tensorsOrDtype) {\n    if (util_1.isNullOrUndefined(tensorsOrDtype)) {\n        throw new Error('Invalid input tensors value.');\n    }\n    return {\n        name: attrName,\n        type: nodeBackend().binding.TF_ATTR_TYPE,\n        value: (tensorsOrDtype instanceof tf.Tensor || Array.isArray(tensorsOrDtype)) ?\n            getTFDTypeForInputs(tensorsOrDtype) :\n            getTFDType(tensorsOrDtype)\n    };\n}\nexports.createTensorsTypeOpAttr = createTensorsTypeOpAttr;\n// TODO(yassogba) remove? who uses this?\nfunction createOpAttr(attrName, tensorsOrDtype, value) {\n    if (util_1.isNullOrUndefined(tensorsOrDtype)) {\n        throw new Error('Invalid input tensors value.');\n    }\n    return { name: attrName, type: nodeBackend().binding.TF_BOOL, value: value };\n}\nexports.createOpAttr = createOpAttr;\n/** Returns the dtype number for a single or list of input Tensors. */\nfunction getTFDTypeForInputs(tensors) {\n    if (util_1.isNullOrUndefined(tensors)) {\n        throw new Error('Invalid input tensors value.');\n    }\n    if (util_1.isArray(tensors)) {\n        for (var i = 0; i < tensors.length; i++) {\n            return getTFDType(tensors[i].dtype);\n        }\n        return -1;\n    }\n    else {\n        return getTFDType(tensors.dtype);\n    }\n}\nfunction ensureTensorflowBackend() {\n    tf.util.assert(tf.getBackend() === 'tensorflow', function () { return \"Expect the current backend to be \\\"tensorflow\\\", but got \\\"\" + tf.getBackend() + \"\\\"\"; });\n}\nexports.ensureTensorflowBackend = ensureTensorflowBackend;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}